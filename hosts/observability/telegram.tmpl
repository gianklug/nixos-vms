{{ define "telegram.message" }}
{{- $firing := .Alerts.Firing -}}
{{- $resolved := .Alerts.Resolved -}}

{{- if gt (len $firing) 0 }}
ğŸ”¥ *FIRING* â€” {{ len $firing }}
{{ range $firing }}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
*{{ or .Annotations.summary .Labels.alertname }}*

{{- with .Annotations.description }}
{{ . }}
{{- end }}

*Severity:* {{ if eq .Labels.severity "critical" }}ğŸŸ¥ critical{{ else if eq .Labels.severity "warning" }}ğŸŸ¨ warning{{ else if eq .Labels.severity "info" }}ğŸŸ¦ info{{ else }}â¬œ unknown{{ end }}
{{- if .Labels.instance }}
*Instance:* `{{ .Labels.instance }}`
{{- end }}
*Started:* {{ .StartsAt.Format "2006-01-02 15:04:05" }}

{{- if or .Labels.cluster .Labels.namespace .Labels.job }}
*Context:*
{{- if .Labels.cluster }} â€¢ *cluster:* `{{ .Labels.cluster }}`{{ end }}
{{- if .Labels.namespace }} â€¢ *ns:* `{{ .Labels.namespace }}`{{ end }}
{{- if .Labels.job }} â€¢ *job:* `{{ .Labels.job }}`{{ end }}
{{- end }}

{{- if or .GeneratorURL .Annotations.runbook_url }}
*Links:*
{{- if .GeneratorURL }} [ğŸ” Query]({{ .GeneratorURL }}){{ end }}
{{- with .Annotations.runbook_url }} | [ğŸ“˜ Runbook]({{ . }}){{ end }}
{{- end }}

{{ end }}
{{ end }}

{{- if gt (len $resolved) 0 }}
âœ… *RESOLVED* â€” {{ len $resolved }}
{{ range $resolved }}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
*{{ or .Annotations.summary .Labels.alertname }}*

{{- if .Labels.instance }}
*Instance:* `{{ .Labels.instance }}`
{{- end }}
*Ended:* {{ .EndsAt.Format "2006-01-02 15:04:05" }}

{{- if .GeneratorURL }}
*Links:* [ğŸ” Query]({{ .GeneratorURL }})
{{- end }}

{{ end }}
{{ end }}
{{ end }}

